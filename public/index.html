<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TEEG Table</title>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #1b7a1b; /* green table */
  color: white;
  overflow-x: hidden;
}
#table-container {
  position: relative;
  width: 100vw;
  height: 100vh;
}
#table {
  position: relative;
  width: 100%;
  height: 100%;
}
.player {
  position: absolute;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.player .player-name { margin-bottom: 5px; font-weight: bold; }
.cards-row {
  display: flex;
  justify-content: center;
  margin: 2px 0;
  position: relative;
}
.card {
  width: 60px;
  height: 85px;
  border-radius: 5px;
  background: white;
  color: black;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-left: -35px;
  font-weight: bold;
  font-size: 20px;
  cursor: pointer;
  box-shadow: 0 2px 5px rgba(0,0,0,0.3);
}
.card.hand { width: 70px; height: 100px; margin-left: -50px; }
.card.back { background: #222; color: transparent; border: 1px solid #555; margin-left: -35px; }
.selected { background: gold !important; color: black; border: 2px solid red; transform: scale(1.1); }

#play-pile, #draw-pile {
  position: absolute;
  width: 80px; height: 110px;
  display: flex; flex-direction: column;
  justify-content: center; align-items: center;
}
#play-pile { top: 45%; left: 50%; transform: translate(-50%, -50%); }
#draw-pile { top: 45%; left: 60%; transform: translate(-50%, -50%); }

.pile-card {
  position: absolute;
  width: 60px; height: 85px;
  border-radius: 5px;
  background: white;
  display: flex; justify-content: center; align-items: center;
  margin-top: -65px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.3);
}
.pile-count {
  position: absolute;
  bottom: -15px;
  right: -15px;
  background: red;
  width: 20px; height: 20px;
  border-radius: 50%;
  font-size: 12px;
  display: flex;
  justify-content: center;
  align-items: center;
}

#hud {
  position: absolute; bottom: 10px; left: 50%;
  transform: translateX(-50%);
  text-align: center;
}
#hud input { padding: 5px; margin: 3px; }
#hud button { padding: 5px 10px; margin: 3px; }

#bomb, #teeg {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  font-size: 48px;
  z-index: 999;
}
#bomb { background: red; }
#teeg { background: black; color: red; flex-direction: column; }

</style>
</head>
<body>
<div id="table-container">
  <div id="table"></div>

  <div id="hud">
    <input id="playerName" placeholder="Your name">
    <button onclick="createRoom()">Create Room</button>
    <input id="roomInput" placeholder="Room code">
    <button onclick="joinRoom()">Join Room</button>
    <button onclick="playSelected()">Play</button>
    <h3 id="turn"></h3>
  </div>

  <div id="play-pile"></div>
  <div id="draw-pile"><div class="card back"></div></div>

  <div id="bomb">ðŸ’¥ BOMB ðŸ’¥</div>
  <div id="teeg"><div id="teegText"></div><button onclick="alert(`YOU'RE SHIT ðŸ˜ˆ`)">YOU'RE SHIT</button></div>
</div>

<script>
const socket = io("https://teeg-server.onrender.com",{transports:["polling"],forceNew:true});
let myId="", roomId="", lastState=null;
let selectedIndexes=[], selectedValue=null;

/* ROOM ACTIONS */
function createRoom(){
  const name=playerName.value.trim();
  if(!name) return alert("Enter name");
  socket.emit("create-room",name,id=>{roomId=id;});
}
function joinRoom(){
  const name=playerName.value.trim();
  roomId=roomInput.value.trim();
  if(!name||!roomId) return;
  socket.emit("join-room",{roomId,name});
}

/* STATE HANDLER */
socket.on("state", state=>{
  lastState=state;
  const table=document.getElementById("table"); table.innerHTML="";
  selectedIndexes=[]; selectedValue=null;

  const positions=["bottom","top","left","right"];
  const current=state.players[state.turn];
  turn.innerText=current.id===myId?"ðŸ‘‰ YOUR TURN":"Waiting for "+current.name;

  state.players.forEach((p,i)=>{
    const playerDiv=document.createElement("div"); playerDiv.className="player "+positions[i];

    // Name
    const nameDiv=document.createElement("div"); nameDiv.className="player-name";
    nameDiv.innerText=p.name+(p.id===current.id?" â­":"");
    playerDiv.appendChild(nameDiv);

    // Table cards (face-down first, then face-up stacked)
    const tableRow=document.createElement("div"); tableRow.className="cards-row";
    (p.faceDown||[]).forEach(()=>{const c=document.createElement("div"); c.className="card back"; tableRow.appendChild(c);});
    (p.faceUp||[]).forEach(card=>{const c=document.createElement("div"); c.className="card"; c.innerText=card; tableRow.appendChild(c);});
    playerDiv.appendChild(tableRow);

    // Hand cards (only bottom player)
    if(p.id===myId){
      const handRow=document.createElement("div"); handRow.className="cards-row";
      handRow.style.position="absolute"; handRow.style.bottom="100px"; handRow.style.left="50%";
      handRow.style.transform="translateX(-50%)";
      (p.hand||[]).forEach((card,idx)=>{
        const c=document.createElement("div"); c.className="card hand"; c.innerText=card;
        if(selectedIndexes.includes(idx)) c.classList.add("selected");
        c.onclick=()=>toggleCard(card,idx);
        handRow.appendChild(c);
      });
      playerDiv.appendChild(handRow);
    }

    table.appendChild(playerDiv);
  });

  // Play pile
  const pp=document.getElementById("play-pile"); pp.innerHTML="";
  const pileCounts={};
  state.pile.forEach(c=>pileCounts[c]=(pileCounts[c]||0)+1);
  Object.keys(pileCounts).forEach((c,i)=>{
    const cardDiv=document.createElement("div"); cardDiv.className="pile-card"; cardDiv.style.top=(i*5)+"px"; cardDiv.innerText=c;
    if(pileCounts[c]>1){const countDiv=document.createElement("div"); countDiv.className="pile-count"; countDiv.innerText=pileCounts[c]; cardDiv.appendChild(countDiv);}
    pp.appendChild(cardDiv);
  });

  // Draw pile
  document.getElementById("draw-pile").innerHTML='<div class="card back"></div>';
});

/* MULTI SELECT HAND CARDS */
function toggleCard(card,index){
  if(!lastState||lastState.players[lastState.turn].id!==myId) return;
  if(selectedValue===null||selectedValue!==card){selectedValue=card; selectedIndexes=[index];}
  else if(selectedIndexes.includes(index)){selectedIndexes=selectedIndexes.filter(i=>i!==index); if(!selectedIndexes.length) selectedValue=null;}
  else selectedIndexes.push(index);
  renderHand();
}
function renderHand(){
  if(!lastState) return;
  const me=lastState.players.find(p=>p.id===myId);
  const handRow=document.querySelector(".card.hand")?.parentElement;
  if(!handRow) return;
  Array.from(handRow.children).forEach((c,i)=>c.classList.toggle("selected",selectedIndexes.includes(i)));
}

/* PLAY CARDS */
function playSelected(){
  if(!lastState||selectedIndexes.length===0) return;
  const me=lastState.players.find(p=>p.id===myId);
  const cards=selectedIndexes.map(i=>me.hand[i]);
  socket.emit("play",{roomId,cards});
  selectedIndexes=[]; selectedValue=null;
}

/* EFFECTS */
socket.on("bomb",()=>{bomb.style.display="flex"; setTimeout(()=>bomb.style.display="none",800);});
socket.on("game-over",data=>{teeg.style.display="flex"; teegText.innerText=data.teeg+" IS THE TEEG";});
socket.on("connect",()=>{myId=socket.id;});
</script>
</body>
</html>





