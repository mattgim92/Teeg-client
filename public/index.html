<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>TEEG</title>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

  <style>
    body {
      background: #0b3d2e;
      color: white;
      font-family: Arial, sans-serif;
      padding: 20px;
      text-align: center;
    }

    button {
      padding: 10px;
      margin: 5px;
      font-size: 16px;
    }

    #players div {
      margin: 4px;
    }

    #hand button {
      min-width: 40px;
    }

    #bomb, #teeg {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      z-index: 999;
    }

    #bomb {
      background: red;
    }

    #teeg {
      background: black;
      color: red;
      flex-direction: column;
    }
  </style>
</head>

<body>

  <div id="bomb">ðŸ’¥ BOMB ðŸ’¥</div>

  <div id="teeg">
    <div id="teegText"></div>
    <button onclick="alert(`YOU'RE SHIT ðŸ˜ˆ`)">YOU'RE SHIT</button>
  </div>

  <h1>TEEG</h1>

  <input id="name" placeholder="Your name"><br><br>

  <button onclick="createRoom()">Create Room</button><br><br>

  <input id="roomInput" placeholder="Room code">
  <button onclick="joinRoom()">Join Room</button>

  <h2 id="room"></h2>
  <h3 id="turn"></h3>

  <h3>Players</h3>
  <div id="players"></div>

  <h3>Your Hand</h3>
  <div id="hand"></div>

  <h3>Play Pile</h3>
  <div id="pile"></div>

<script>
/* ---------------- CONNECTION ---------------- */

const socket = io("https://teeg-server.onrender.com", {
  transports: ["polling"],
  forceNew: true
});

let myName = "";
let roomId = "";
let myId = "";

socket.on("connect", () => {
  myId = socket.id;
  alert("CONNECTED TO SERVER");
});

socket.on("connect_error", err => {
  alert("CONNECT ERROR: " + err.message);
});

/* ---------------- ROOM ACTIONS ---------------- */

function createRoom() {
  myName = name.value.trim();
  if (!myName) return alert("Enter name");

  socket.emit("create-room", myName, id => {
    roomId = id;
    room.innerText = "Room: " + id;
  });
}

function joinRoom() {
  myName = name.value.trim();
  roomId = roomInput.value.trim();
  if (!myName || !roomId) return alert("Enter name & room");

  room.innerText = "Room: " + roomId;
  socket.emit("join-room", { roomId, name: myName });
}

/* ---------------- STATE HANDLER ---------------- */

socket.on("state", state => {
  // Clear UI
  players.innerHTML = "";
  hand.innerHTML = "";
  pile.innerHTML = "";

  if (!state.players || state.players.length === 0) return;

  const currentPlayer = state.players[state.turn];

  // Turn indicator
  turn.innerText =
    currentPlayer.id === myId
      ? "ðŸ‘‰ YOUR TURN"
      : "Waiting for " + currentPlayer.name;

  // Players + hand
  state.players.forEach(p => {
    const div = document.createElement("div");
    div.innerText = p.name;

    if (p.id === currentPlayer.id) {
      div.style.fontWeight = "bold";
      div.innerText += " â­";
    }

    players.appendChild(div);

    // Only render MY hand
    if (p.id === myId) {
      p.hand.forEach(card => {
        const btn = document.createElement("button");
        btn.innerText = card;

        if (currentPlayer.id !== myId) {
          btn.disabled = true;
        }

        btn.onclick = () => {
          socket.emit("play", { roomId, card });
        };

        hand.appendChild(btn);
      });
    }
  });

  // Render pile
  state.pile.forEach(card => {
    pile.innerText += card + " ";
  });
});

/* ---------------- EFFECTS ---------------- */

socket.on("bomb", () => {
  bomb.style.display = "flex";
  setTimeout(() => bomb.style.display = "none", 800);
});

socket.on("game-over", data => {
  teeg.style.display = "flex";
  teegText.innerText = data.teeg + " IS THE TEEG";
});
</script>

</body>
</html>
